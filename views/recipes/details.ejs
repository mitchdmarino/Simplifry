<div class="">
    <h2 class="text-4xl text-center my-4"> <%= recipe.name %> </h2>
    <div class="flex w-4/5 mx-auto justify-evenly">
        <img src="<%=recipe.img%>" class="h-[400px] text-center">
        <div id="nutritional information" class="h-[400px] w-[300px] grid grid-cols-3 grid-rows-9">
            <div class="h-[50px] w-[100px]" >Name</div>
            <div>Total</div>
            <div>% DV</div>
            <div>Calories (kCal)</div>
            <div>
                <% let totalCalories = 0 %>
                <% ingredients.forEach(ingredient => { %>
                    <% if (ingredient.energy) { %>
                        <%totalCalories+= Number(ingredient.energy) %>
                    <% } %>
                <% }) %>
                <%=Math.floor(totalCalories)%>
            </div>
            <div>%</div>
            <div>
                Protein(g)
            </div>
            <div>
                <% let totalProtein = 0 %>
                <% ingredients.forEach(ingredient => { %>
                    <% if (ingredient.protein) { %>
                        <%totalProtein+= Number(ingredient.protein) %>
                    <% } %>
                <% }) %>
                <%=Math.floor(totalProtein)%>
            </div>
            <div>%</div>
            <div>Fat (g)</div>
            <div><% let totalFat = 0 %>
                <% ingredients.forEach(ingredient => { %>
                    <% if (ingredient.fat) { %>
                        <%totalFat+= Number(ingredient.fat) %>
                    <% } %>
                <% }) %>
                <%=Math.floor(totalFat)%></div>
            <div>%</div>
            <div>Carbohydrates (g)</div>
            <div><% let totalCarbs = 0 %>
                <% ingredients.forEach(ingredient => { %>
                    <% if (ingredient.carbs) { %>
                        <%totalCarbs+= Number(ingredient.carbs) %>
                    <% } %>
                <% }) %>
                <%=Math.floor(totalCarbs)%></div>
            <div>%</div>
            <div>Sugar (g)</div>
            <div><% let totalSugar = 0 %>
                <% ingredients.forEach(ingredient => { %>
                    <% if (ingredient.sugar) { %>
                        <%totalSugar+= Number(ingredient.sugar) %>
                    <% } %>
                <% }) %>
                <%=Math.floor(totalSugar)%></div>
            <div>%</div>
            <div>Fiber (g)</div>
            <div><% let totalFiber = 0 %>
                <% ingredients.forEach(ingredient => { %>
                    <% if (ingredient.fiber) { %>
                        <%totalFiber+= Number(ingredient.fiber) %>
                    <% } %>
                <% }) %>
                <%=Math.floor(totalFiber)%></div>
            <div>%</div>
            <div>Sodium (mg)</div>
            <div><% let totalSodium = 0 %>
                <% ingredients.forEach(ingredient => { %>
                    <% if (ingredient.NA) { %>
                        <%totalSodium+= Number(ingredient.NA) %>
                    <% } %>
                <% }) %>
                <%=Math.floor(totalSodium)%></div>
            <div>%</div>
            <div>Cholesterol (mg)</div>
            <div><% let totalCholesterol = 0 %>
                <% ingredients.forEach(ingredient => { %>
                    <% if (ingredient.cholesterol) { %>
                        <%totalCholesterol+= Number(ingredient.cholesterol) %>
                    <% } %>
                <% }) %>
                <%=Math.floor(totalCholesterol)%></div>
            <div>%</div>

        </div>
    </div>

    <div id="ingredients-container" class="">
       
        
        <% if(ingredients.length>0) { %>
            <table class="table-auto w-3/4 mx-auto mt-5 text-sm text-left text-gray-500 ">
                <thead class="text-xs text-gray-700 uppercase bg-gray-50">
                <tr >
                    <th scope="col" class="px-6 py-3">Ingredient</th>
                    <th scope="col" class="px-6 py-3">Amount</th>
                    <th scope="col" class="px-6 py-3">Unit</th>
                    <th scope="col" class="px-6 py-3">Nutritional Info</th>
                </tr>
                </thead>
                <tbody>
                    <% ingredients.forEach(ingredient => { %>
                        <tr class="bg-white border-b ">
                            <th scope="row" class="px-6 py-4 font-medium text-gray-900"><%=ingredient.name%></th>
                            <td class="px-6 py-4"><%=ingredient.quantity%></td>
                            <td class="px-6 py-4"><%=ingredient.measure%></td>
                            <% if (!ingredient.energy) { %>
                                <td class="px-6 py-4" >Not Available</td>
                            <% } else {%>
                                <td class="px-6 py-4" ><a href="#">See More</a></td>
                            <% } %>
                        </tr>
                        <%}) %>
                </tbody>
            </table>
        <% } else {%>
            <p class="text-center  ">Add Ingredients Below</p>
            <% } %>
    </div>
    </div>

    <div id="directions-container" class="text-left">
        <h3 class="text-2xl">Directions: </h3> 
        <% // show the directions over multiple lines %>
          <% let directions = recipe.directions %>
           <% let stepByStep = directions.split('..') %>
           <% stepByStep.forEach(step => { %>
                <p><%=step%></p>
           <% }) %> 
    </div>

    <div id="story-container" class="text-center">
        <h3 class="text-2xl">Story: </h3>

        <p><%= recipe.story %></p>
    </div>

    <div id="notes-container" class="text-center">
        <h3 class="text-2xl">Additional notes: </h3>

        <p><%= recipe.notes%></p>   
    </div>
    <div class="flex mx-auto w-1/2">
        <div class="w-1/2">
            <a href="/recipes/<%=recipe.id%>/ingredients/new" class="flex justify-center"><button class="mx-auto focus:outline-none text-white bg-red-700 hover:bg-red-800 focus:ring-4 focus:ring-red-300 font-medium rounded-lg text-sm px-5 py-2.5">Edit Recipe</button></a>
        </div>
        <div class="w-1/2">
            <form method="POST" action="/recipes/<%= recipe.id %>/?_method=DELETE" class="flex justify-center">
                <button type="submit"class=" focus:outline-none text-white bg-black hover:bg-gray-800 focus:ring-4 focus:ring-black-300 font-medium rounded-lg text-sm px-5 py-2.5 ">Delete Recipe</button>
            </form>
        </div>
    </div>
    <div id="tag-container" class="">
        <h3>Tags:</h3>
        <% if (recipeCategories.length>0) { %>
            <%recipeCategories.forEach(category => {%>
                <li><%=category.name%></li>
            <% }) } else {%>
                <p>There are currently no associated tags</p>
                <%}%>
                <button id="addTagButton" class="focus:outline-none text-white bg-black hover:bg-gray-800 focus:ring-4 focus:ring-black-300 font-medium rounded-lg text-sm px-5 py-2.5 mr-2 mb-2">Add a tag</button>
                <div class="hidden "id="addTagForm">
                    
                    <form method="POST" action="/recipes/<%=recipe.id%>/categories/add/?_method=PUT">
                        <label for="category">Tag:</label>
                        <select name="category" id="category" class="w-48">
                            <% if (categories) { %>
                                <%categories.forEach(category => {%>
                                    
                                    <option value="<%=category.id %>"><%= category.name %></option>
                            <% }) } %>
                        </select>
                        <button type="submit" class="focus:outline-none text-white bg-black hover:bg-gray-800 focus:ring-4 focus:ring-black-300 font-medium rounded-lg text-sm px-5 py-2.5 mr-2 mb-2 ">Confirm</button>
        
                    </form>
        
                    <% if (recipeCategories.length>0) { %>
                    <form method="POST" action="/recipes/<%=recipe.id%>/categories/remove/?_method=PUT">
                        <label for="category">Remove Tag:</label>
                        <select name="category" id="category">
                            
                                <%recipeCategories.forEach(category => {%>
                                    
                                    <option value="<%=category.id %>"><%= category.name %></option>
                            
                        </select>
                        <button type="submit" class="focus:outline-none text-white bg-black hover:bg-gray-800 focus:ring-4 focus:ring-black-300 font-medium rounded-lg text-sm px-5 py-2.5 mr-2 mb-2 ">Confirm</button>
        
                    </form>
            <% }) } %>
                    
                </div>
    </div>

</div>

<script src="/javascript/addTags.js"></script>